# üé∞ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –≤—ã–ø–ª–∞—Ç—ã –≤—ã–∏–≥—Ä—ã—à–µ–π

## üîß –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –≤—ã–∏–≥—Ä—ã—à–µ –≤ –ª–æ—Ç–µ—Ä–µ–µ –∑–≤–µ–∑–¥—ã –Ω–µ –ø–æ—Å—Ç—É–ø–∞—é—Ç –≤ –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram. –°–∏—Å—Ç–µ–º–∞ –ø—ã—Ç–∞–ª–∞—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã Telegram Bot API (`sendGift`, `refundStarPayment` –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏).

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### üìã –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

1. **–°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ PayoutWinnings** - –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–ø–ª–∞—Ç
2. **–û–±–Ω–æ–≤–ª—ë–Ω ProcessLotteryResult** - –ª–æ–≥–∏–∫–∞ –ø–æ–ø—ã—Ç–∫–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ —á–µ—Ä–µ–∑ —Ä–µ–∞–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
3. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–ú–æ–π –±–∞–ª–∞–Ω—Å"** - –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –∑–≤–µ–∑–¥
4. **–£–ª—É—á—à–µ–Ω—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - –æ–±—ä—è—Å–Ω—è—é—Ç –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏–ª –≤—ã–∏–≥—Ä—ã—à

### üöÄ –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –≤—ã–ø–ª–∞—Ç—ã –≤—ã–∏–≥—Ä—ã—à–µ–π:

#### –ú–µ—Ç–æ–¥ 1: –í–æ–∑–≤—Ä–∞—Ç —á–µ—Ä–µ–∑ Telegram API ‚≠ê
- –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–µ–∞–ª—å–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø–æ–∫—É–ø–∫–∏ –±–∏–ª–µ—Ç–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `refundStarPayment` —Å ID —Ä–µ–∞–ª—å–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ó–≤–µ–∑–¥—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –ø—Ä—è–º–æ –≤ –∞–∫–∫–∞—É–Ω—Ç Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### –ú–µ—Ç–æ–¥ 2: –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö üíæ
- –ï—Å–ª–∏ Telegram API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –Ω–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ó–≤–µ–∑–¥—ã –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –±–∞–ª–∞–Ω—Å –±–æ—Ç–∞
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –Ω–æ–≤—ã—Ö –±–∏–ª–µ—Ç–æ–≤

### üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

```bash
# 1. –¢–µ—Å—Ç –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –≤—ã–ø–ª–∞—Ç
php artisan lottery:test-winning-payout --user-id=–í–ê–®_TELEGRAM_ID --amount=10

# 2. –¢–µ—Å—Ç –ø–æ–ª–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –ª–æ—Ç–µ—Ä–µ–∏
php artisan lottery:test --quick --user-id=–í–ê–®_TELEGRAM_ID

# 3. –†—É—á–Ω–∞—è –≤—ã–ø–ª–∞—Ç–∞ –≤—ã–∏–≥—Ä—ã—à–∞
php artisan lottery:payout-winnings –í–ê–®_TELEGRAM_ID 10 --reason="–¢–µ—Å—Ç–æ–≤—ã–π –≤—ã–∏–≥—Ä—ã—à"

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
php artisan stars:manage balance –í–ê–®_TELEGRAM_ID
```

### üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```bash
# –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –±–∞–ª–∞–Ω—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
php artisan migrate
```

### üì± –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

1. **–ö–Ω–æ–ø–∫–∞ "üí∞ –ú–æ–π –±–∞–ª–∞–Ω—Å"** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
   - –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –∑–≤–µ–∑–¥
   - –ü–æ—Å–ª–µ–¥–Ω–∏–µ 5 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–≥—Ä
   - –û–±—â–∏–π –≤—ã–∏–≥—Ä—ã—à

2. **–£–ª—É—á—à–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≤—ã–∏–≥—Ä—ã—à–µ**:
   - –û–±—ä—è—Å–Ω—è—é—Ç –≥–¥–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤—ã–∏–≥—Ä–∞–Ω–Ω—ã–µ –∑–≤–µ–∑–¥—ã
   - –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç –º–µ—Ç–æ–¥ –∑–∞—á–∏—Å–ª–µ–Ω–∏—è
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

3. **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**:
   - –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –±–∞–∑—É
   - –í–∏–¥–Ω–∞ –∏—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –≤—ã–∏–≥—Ä—ã—à–µ–π
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –≤—ã–ø–ª–∞—Ç

### ‚ùó –í–∞–∂–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

#### Telegram Stars API –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- `sendGift` - –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º API
- `refundStarPayment` - —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
- –ü—Ä—è–º–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–≤–µ–∑–¥ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞

#### –†–µ—à–µ–Ω–∏—è:
- **–†–µ–∞–ª—å–Ω—ã–µ –≤—ã–∏–≥—Ä—ã—à–∏**: –í–æ–∑–≤—Ä–∞—Ç —á–µ—Ä–µ–∑ `refundStarPayment`
- **–¢–µ—Å—Ç–æ–≤—ã–µ –≤—ã–∏–≥—Ä—ã—à–∏**: –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: –û–±—ä—è—Å–Ω—è—é—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≥–¥–µ –∏—Å–∫–∞—Ç—å –∑–≤–µ–∑–¥—ã

### üîç –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤—ã–ø–ª–∞—Ç
tail -f storage/logs/laravel.log | grep "lottery_win\|Stars credited\|refunded"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—á–µ—Ä–µ–¥–∏
php artisan queue:monitor

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
php artisan tinker
>>> \App\Models\StarTransaction::where('type', 'lottery_win')->latest()->get()
```

### üìä –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–∏–≥—Ä—ã–≤–∞–µ—Ç** ‚Üí –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
2. **–°–∏—Å—Ç–µ–º–∞ –ø—ã—Ç–∞–µ—Ç—Å—è –≤–æ–∑–≤—Ä–∞—Ç** ‚Üí —á–µ—Ä–µ–∑ Telegram API
3. **–ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å** ‚Üí –Ω–∞—á–∏—Å–ª—è–µ—Ç –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
4. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –±–∞–ª–∞–Ω—Å** ‚Üí –∫–Ω–æ–ø–∫–∞ "–ú–æ–π –±–∞–ª–∞–Ω—Å"
5. **–ú–æ–∂–µ—Ç —Ç—Ä–∞—Ç–∏—Ç—å –∑–≤–µ–∑–¥—ã** ‚Üí –Ω–∞ –Ω–æ–≤—ã–µ –±–∏–ª–µ—Ç—ã

### üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –í—ã–∏–≥—Ä—ã—à–∏ –¥–æ—Ö–æ–¥—è—Ç –¥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ü—Ä–æ–∑—Ä–∞—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É—á–µ—Ç–∞
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ Fallback —á–µ—Ä–µ–∑ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
