# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é Telegram Stars –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥–µ

## ‚ö° –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

–í—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–∏ –∫–æ–º–∞–Ω–¥—ã –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥–µ:

```bash
# 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
php8.1 artisan bot:setup-hosting

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫  
php8.1 artisan bot:check-stars-setup

# 3. –ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã - –∞–≤—Ç–æ–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
php8.1 artisan bot:check-stars-setup --fix

# 4. –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
php8.1 artisan bot:check-stars-setup
```

## üîß –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)
- `APP_URL=https://tg.sticap.ru`
- `APP_ENV=production`
- `TELEGRAM_BOT_TOKEN=8410914085:AAEkR3kyRw-lvb8WRP0MRQugvpEH-fkhLp4`
- –ò –¥—Ä—É–≥–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

### 2. Webhook –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- URL: `https://tg.sticap.ru/api/telegram/webhook`
- –í–∫–ª—é—á–µ–Ω–∏–µ `pre_checkout_query` (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è Stars)
- –í–∫–ª—é—á–µ–Ω–∏–µ `successful_payment` (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è Stars)
- –û—á–∏—Å—Ç–∫–∞ –Ω–∞–∫–æ–ø–∏–≤—à–∏—Ö—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

### 3. CSRF –∑–∞—â–∏—Ç–∞
- –û—Ç–∫–ª—é—á–µ–Ω–∏–µ CSRF –¥–ª—è `/api/telegram/webhook`
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–æ—É—Ç–æ–≤

## üìã –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥–∞ `php8.1 artisan bot:check-stars-setup` –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç—å:

```
‚úÖ –£—Å–ø–µ—à–Ω–æ: 15
‚ùå –ü—Ä–æ–±–ª–µ–º: 0

üéâ –í–°–ï –ü–†–û–í–ï–†–ö–ò –ü–†–û–ô–î–ï–ù–´! Stars –ø–ª–∞—Ç–µ–∂–∏ –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–ª–∞—Ç–µ–∂–∏:

```bash
# –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Å—á–µ—Ç –≤–∞—à–µ–º—É Telegram ID
php8.1 artisan bot:test-stars-payment

# –ò–ª–∏ —É–∫–∞–∑–∞—Ç—å –¥—Ä—É–≥–æ–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
php8.1 artisan bot:test-stars-payment 123456789
```

## üìû –í —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º

–ï—Å–ª–∏ –∫–æ–º–∞–Ω–¥—ã –Ω–µ –ø–æ–º–æ–≥–∞—é—Ç, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **–ü—Ä–∞–≤–∞ –Ω–∞ —Ñ–∞–π–ª—ã**: –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Laravel –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å –≤:
   - `storage/logs/`
   - `.env` —Ñ–∞–π–ª

2. **PHP –≤–µ—Ä—Å–∏—è**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `php8.1` –≤–º–µ—Å—Ç–æ `php`

3. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MySQL —Ä–∞–±–æ—Ç–∞–µ—Ç

4. **SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç**: Telegram —Ç—Ä–µ–±—É–µ—Ç HTTPS –¥–ª—è webhook

## üÜò –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook
curl -s "https://api.telegram.org/bot8410914085:AAEkR3kyRw-lvb8WRP0MRQugvpEH-fkhLp4/getWebhookInfo" | jq

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ endpoint
curl -v -X POST "https://tg.sticap.ru/api/telegram/webhook" -d '{"test":true}'

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ Laravel  
tail -f storage/logs/laravel.log
```

## üéØ –ö–ª—é—á–µ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è Stars

1. ‚úÖ –í–∞–ª—é—Ç–∞: `XTR` (Telegram Stars)
2. ‚úÖ Provider token: –ø—É—Å—Ç–æ–π –¥–ª—è Stars
3. ‚úÖ Webhook –≤–∫–ª—é—á–∞–µ—Ç `pre_checkout_query`
4. ‚úÖ Webhook –≤–∫–ª—é—á–∞–µ—Ç `successful_payment`
5. ‚úÖ HTTPS endpoint –¥–æ—Å—Ç—É–ø–µ–Ω
6. ‚úÖ –û—Ç–≤–µ—Ç –Ω–∞ `pre_checkout_query` < 10 —Å–µ–∫—É–Ω–¥
